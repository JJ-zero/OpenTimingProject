static const char  responseHTML[] PROGMEM= R"(<!DOCTYPE html> <html lang='en'> <head> <meta name='viewport' content='width=device-width'> <title>Open Timing Project</title> <style> body { font-family: Arial, sans-serif; margin: 0; padding: 0; } h1 { background-color: #333; color: white; margin: 0; padding: 10px; } div { margin: 10px; } a { display: block; margin: 10px; } .main { margin: 10px; font-size: 4em; font-weight: bold; text-align: center; } .table { display: grid; grid-template-columns: max-content auto; grid-gap: 10px; margin: 10px; font-size: 2em; padding-left: 2em; } </style> <script> var currentRunStart = 0; var lastId = 0; function convertToTime(time) { let miliseconds = time % 1000; let seconds = Math.floor(time / 1000) % 60; let minutes = Math.floor(time / 60000); return minutes + ':' + (seconds < 10 ? '0' : '') + seconds + '.' + (miliseconds < 100 ? '0' : '') + (miliseconds < 10 ? '0' : '') + miliseconds; } function writeToSite(data) { console.log(data); currentRunStart = data.current == 0 ? 0 : (new Date()).getTime() - data.current ; if (currentRunStart == 0) { document.getElementById('currentTime').innerText = "Ready!"; } document.getElementById('lastTime').innerText = convertToTime(data.lastFinished); if (data.runId != lastId) { let table = document.querySelector('.table'); let elemTime = document.createElement("i"); let elemId = document.createElement("b") ; elemTime.innerText = convertToTime(data.lastFinished) ; elemId.innerText = "Run " + lastId + ":"; table.insertBefore(elemTime , table.firstChild); table.insertBefore(elemId, table.firstChild); lastId = data.runId; } } ; function update() { fetch("http://192.168.255.1/app/records").then((r) => r.json()).then(writeToSite) ; } ; function updateDisplay() { if (currentRunStart != 0) { document.getElementById('currentTime').innerText = convertToTime((new Date()).getTime() - currentRunStart); } } setInterval(updateDisplay, 100); setInterval(update, 1000); </script> </head> <body> <h1>Open Timing Project</h1> <a href="http://192.168.255.1">Link for browser.</a> <div class="main"> <div>Current: <span id='currentTime'></span></div> <div>Last run: <span id='lastTime'></span></div> </div> <div class="table"></div> </body> </html>)";
